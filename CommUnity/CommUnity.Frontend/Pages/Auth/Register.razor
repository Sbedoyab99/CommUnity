@page "/auth/register"

@if (loading)
{
    <Loading />
}
else
{
    <MudItem>
        <MudText Typo="Typo.h5">Registro de Usuario</MudText>
    </MudItem>
    <EditForm Model="userDTO">
        <DataAnnotationsValidator />
        <MudGrid>
            <MudItem xs="12" sm="6">
                <MudCardContent>
                    <MudTextField Label="Nombre"
                                  @bind-Value="userDTO.FirstName"
                                  For="@(() => userDTO.FirstName)" />
                    <MudTextField Label="Apellido"
                                  @bind-Value="userDTO.LastName"
                                  For="@(() => userDTO.LastName)" />
                    <MudTextField Label="Documento"
                                  @bind-Value="userDTO.Document"
                                  For="@(() => userDTO.Document)" />
                    <MudTextField Label="Telefono"
                                  @bind-Value="userDTO.PhoneNumber"
                                  For="@(() => userDTO.PhoneNumber)" />
                    <MudTextField Label="Email"
                                  @bind-Value="userDTO.Email"
                                  For="@(() => userDTO.Email)" />
                    <MudItem xs="12" sm="12">
                        <MudTextField Label="Contraseña" InputType="InputType.Password" @bind-Value="@userDTO.Password" />
                        <ValidationMessage For="@(() => userDTO.Password)" />
                    </MudItem>
                    <MudItem xs="12" sm="12">
                        <MudTextField Label="Confirmar Contraseña" InputType="InputType.Password" @bind-Value="@userDTO.PasswordConfirm" />
                        <ValidationMessage For="@(() => userDTO.PasswordConfirm)" />
                    </MudItem>
                </MudCardContent>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudCardContent>
                    <MudAutocomplete T="Country"
                                     Label="País"
                                     Placeholder="--Seleccione un País--"
                                     SearchFunc="SearchCountries"
                                     Value="selectedCountry"
                                     ValueChanged="CountryChangedAsync"
                                     ToStringFunc="@(e=> e==null?null : $"{e.Name}")">
                        <ItemTemplate Context="itemContext">
                            @itemContext.Name
                        </ItemTemplate>
                    </MudAutocomplete>
                    <MudAutocomplete T="State"
                                     Label="Estado"
                                     Placeholder="--Seleccione un Estado--"
                                     SearchFunc="SearchStates"
                                     Value="selectedState"
                                     ValueChanged="StateChangedAsync"
                                     ToStringFunc="@(e=> e==null?null : $"{e.Name}")">
                        <ItemTemplate Context="itemContext">
                            @itemContext.Name
                        </ItemTemplate>
                    </MudAutocomplete>
                    <MudAutocomplete T="City"
                                     Label="Ciudad"
                                     Placeholder="--Seleccione una Ciudad--"
                                     SearchFunc="SearchCity"
                                     Value="selectedCity"
                                     ValueChanged="CityChangedAsync"
                                     ToStringFunc="@(e=> e==null?null : $"{e.Name}")">
                        <ItemTemplate Context="itemContext">
                            @itemContext.Name
                        </ItemTemplate>
                    </MudAutocomplete>
                    <MudAutocomplete T="ResidentialUnit"
                                     Label="Unidad Residencial"
                                     Placeholder="--Seleccione una Unidad Residencial--"
                                     SearchFunc="SearchResidentialUnit"
                                     Value="selectedResidentialUnit"
                                     ValueChanged="ResidentialUnitChangedAsync"
                                     ToStringFunc="@(e=> e==null?null : $"{e.Name}")">
                        <ItemTemplate Context="itemContext">
                            @itemContext.Name
                        </ItemTemplate>
                    </MudAutocomplete>
                    <MudAutocomplete T="Apartment"
                                     Label="Apartamento"
                                     Placeholder="--Seleccione un Apartamento--"
                                     SearchFunc="SearchApartment"
                                     Value="selectedApartment"
                                     ValueChanged="ApartmentChangedAsync"
                                     ToStringFunc="@(e=> e==null?null : $"{e.Number}")">
                        <ItemTemplate Context="itemContext">
                            @itemContext.Number
                        </ItemTemplate>
                    </MudAutocomplete>
                    <MudSelect Label="Rol"
                               T=UserType
                               Value="userType"
                               ValueChanged="@((UserType userType) => UserTypeChanged(userType))"
                               For="@(() => userDTO.UserType)">
                        @foreach (var userType in userTypes)
                        {
                            <MudSelectItem Value="@userType.Item1">@userType.Item2</MudSelectItem>
                        }
                    </MudSelect>
                </MudCardContent>
            </MudItem>
            <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.ArrowBack" Color="Color.Info" OnClick="ReturnAction">
                Regresar
            </MudButton>
            <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Check" Color="Color.Primary" OnClick="CreateUserAsync">
                Guardar
            </MudButton>
        </MudGrid>
    </EditForm>
}